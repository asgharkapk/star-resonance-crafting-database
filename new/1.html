<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Recipe Dependency Tree</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f5f5;
  }
  #uploadBox {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  #tree {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    white-space: pre;
    font-family: Consolas, monospace;
  }
  .node {
    margin-left: 20px;
  }
</style>
</head>
<body>
<h2>Recipe Dependency Tree</h2>

<div id="uploadBox">
  <p><strong>Upload recipe JSON file:</strong></p>
  <input type="file" id="fileInput" accept=".json">
</div>

<div id="tree">Tree will appear here...</div>

<script>
// Expected JSON format example:
// {
//   "items": {
//     "Iron Bar": { "cost": 10, "from": ["Iron Ore"], "used_in": ["Sword"] },
//     "Iron Ore": { "cost": 2, "from": [], "used_in": ["Iron Bar"] },
//     "Sword": { "cost": 50, "from": ["Iron Bar", "Wood"], "used_in": [] },
//     "Wood": { "cost": 1, "from": [], "used_in": ["Sword"] }
//   }
// }

const fileInput = document.getElementById("fileInput");
const treeDiv = document.getElementById("tree");

fileInput.addEventListener("change", () => {
  const file = fileInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      const treeText = generateTree(data.items);
      treeDiv.textContent = treeText;
    } catch (err) {
      treeDiv.textContent = "Error: Invalid JSON format";
    }
  };
  reader.readAsText(file);
});

function generateTree(items) {
  let output = "";

  Object.keys(items).forEach(name => {
    output += formatItem(name, items[name], 0);
  });

  return output;
}

function formatItem(name, item, level) {
  const indent = "  ".repeat(level);
  let str = `${indent}- ${name} (Cost: ${item.cost})\n`;

  if (item.from && item.from.length > 0) {
    str += `${indent}  From:\n`;
    item.from.forEach(src => {
      str += `${indent}    → ${src}\n`;
    });
  }

  if (item.used_in && item.used_in.length > 0) {
    str += `${indent}  Used In:\n`;
    item.used_in.forEach(dst => {
      str += `${indent}    → ${dst}\n`;
    });
  }

  return str;
}
</script>
</body>
</html>
