<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Star Resonance Crafting Guide</title>
<style>
/* ===== Global Style ===== */
body { font-family: "Segoe UI", Roboto, sans-serif; background: radial-gradient(circle at top, #0b0f2a, #05071a); color: #f4f4f4; margin:0; padding:0; }
header { background: linear-gradient(90deg, #2a2f5a, #0b0f2a); padding: 20px 30px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.3);}
header h1 { margin:0; font-size:2em; color:#74b9ff; text-transform: uppercase; letter-spacing:2px;}
nav { background:#101439; padding:10px 0; text-align:center;}
nav a { color:#a0c4ff; text-decoration:none; margin:0 15px; font-weight:500; transition:0.2s;}
nav a:hover { color:#fff; text-shadow:0 0 10px #74b9ff;}
main { padding:30px; max-width:900px; margin:auto;}
section { margin-bottom:50px;}
h2 { border-left:5px solid #74b9ff; padding-left:10px; color:#a0c4ff;}
table { width:100%; border-collapse:collapse; margin-top:10px;}
th,td { border:1px solid #2a2f5a; padding:10px; text-align:left;}
th { background-color:#1b2045; }
tr:nth-child(even){background-color:#0f132f;}
footer { text-align:center; padding:20px; color:#aaa; font-size:0.9em; border-top:1px solid #2a2f5a; background-color:#05071a;}
.note { color:#ccc; font-style:italic; font-size:0.9em;}
.highlight { color:#74b9ff; font-weight:bold; }
.item-link { color:#74b9ff; cursor:pointer; text-decoration:underline;}
.item-link:hover { color:#fff;}
/* Modal */
.modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center;}
.modal.hidden { display:none;}
.modal-content { background:#101439; color:#f4f4f4; padding:20px 30px; border-radius:10px; max-width:600px; width:90%; box-shadow:0 0 20px #74b9ff;}
#modal-close { float:right; font-size:24px; cursor:pointer; color:#74b9ff;}
</style>
</head>
<body>
<header>
<h1>Star Resonance Crafting Guide</h1>
</header>

<nav>
<a href="#overview">Overview</a>
<a href="#materials">Materials</a>
<a href="#recipes">Recipes</a>
<a href="#cost">Cost Efficiency</a>
</nav>

<main>
<section id="overview">
<h2>Overview</h2>
<p>Welcome to the <span class="highlight">Star Resonance Crafting Guide</span> ‚Äî your reference for crafting materials, artisanry combinations, and cost optimization.</p>
</section>

<section id="csv-output">
<!-- All CSV tables will load here -->
</section>
</main>

<div id="item-modal" class="modal hidden">
  <div class="modal-content">
    <span id="modal-close">&times;</span>
    <h2 id="modal-title"></h2>
    <div id="modal-details"></div>
  </div>
</div>

<footer>
<p>¬© 2025 Star Resonance Fan Project ‚Äî Data gathered by community contributors.</p>
</footer>

<script>
// --- CSV Loader ---
async function loadCSV(path){
    const res = await fetch(path);
    const text = await res.text();
    const lines = text.trim().split("\n");
    const headers = lines[0].split(",").map(h=>h.trim());
    return lines.slice(1).map(line=>{
        const values = [];
        let current="", inQuotes=false;
        for(let c of line){
            if(c==='"') inQuotes=!inQuotes;
            else if(c===','&&!inQuotes){values.push(current.trim());current="";}
            else current+=c;
        }
        values.push(current.trim());
        const row={};
        headers.forEach((h,i)=>row[h]=values[i]||"");
        return row;
    });
}

function makeClickableCell(text){
    return `<span class="item-link" data-item="${text}">${text}</span>`;
}

// --- Build Table Sections ---
function createTableSection(filename, headers, rows){
    const container = document.getElementById("csv-output");
    const section = document.createElement("section");
    const title = filename.replace(".csv","").replace(/_/g," ");
    section.innerHTML = `<h2>${title}</h2><table>
    <thead><tr>${headers.map(h=>`<th>${h}</th>`).join("")}</tr></thead>
    <tbody>${rows.map(r=>`<tr>${headers.map(h=>{
        const val = r[h]||"";
        if(h.toLowerCase().includes("item")||h.toLowerCase().includes("to")||h.toLowerCase().includes("from")){
            return `<td>${makeClickableCell(val)}</td>`;
        }
        return `<td>${val}</td>`;
    }).join("")}</tr>`).join("")}</tbody></table>`;
    container.appendChild(section);
}

// --- Load All CSVs from index.json ---
let allData = {}; // will hold all CSVs
async function loadAllCSVs(){
    const DATA_DIR = "./data";
    try{
        const resp = await fetch(`${DATA_DIR}/index.json`);
        if(!resp.ok) throw new Error("index.json not found");
        const {files} = await resp.json();
        for(const file of files){
            const rows = await loadCSV(`${DATA_DIR}/${file}`);
            if(rows.length>0){
                createTableSection(file,Object.keys(rows[0]),rows);
                allData[file.replace(/\.[^/.]+$/,"").toLowerCase()] = rows;
            }
        }
    }catch(e){
        const container = document.getElementById("csv-output");
        container.innerHTML = `<p style="color:red;">‚ö†Ô∏è Error loading CSVs: ${e.message}</p>`;
    }
}
loadAllCSVs();

// --- Item Modal ---
document.addEventListener("click", async e=>{
    if(!e.target.classList.contains("item-link")) return;

    const item = e.target.dataset.item.toLowerCase();
    const modal = document.getElementById("item-modal");
    const title = document.getElementById("modal-title");
    const details = document.getElementById("modal-details");

    title.textContent = e.target.dataset.item;
    details.innerHTML="<p>Loading details...</p>";
    modal.classList.remove("hidden");

    let sources=[], usedIn=[], shopData=[];

    // Search all CSVs
    Object.values(allData).forEach(rows=>{
        rows.forEach(r=>{
            const action = r.action || r.category || "‚Äî";
            const from = r.from||"";
            const to = r.to||"";
            const cost = r.cost || r.cost_F || r.cost_L || r.cost_H || "N/A";

            if(to.toLowerCase()===item) sources.push({action, from, to, cost});
            if(from.toLowerCase().includes(item)) usedIn.push({action, from, to, cost});

            if(r.item && r.item.toLowerCase()===item) shopData.push(r);
        });
    });

    let html="";
    if(sources.length) html+=`<h3>üî® Crafted From:</h3><ul>`+sources.map(s=>`<li>${s.action} ‚Üí ${s.from} (${s.cost})</li>`).join("")+"</ul>";
    if(usedIn.length) html+=`<h3>üß© Used In:</h3><ul>`+usedIn.map(u=>`<li>${u.action} ‚Üí ${u.to} (${u.cost})</li>`).join("")+"</ul>";
    if(shopData.length) html+=`<h3>üè™ Shop Prices:</h3><ul>`+shopData.map(s=>`<li>${s.source}: ${s.cost}${s.currency||""}</li>`).join("")+"</ul>";

    if(!html) html="<p>No details found.</p>";

    // Best price suggestion
    const cheapest = shopData.filter(s=>s.cost).sort((a,b)=>parseFloat(a.cost)-parseFloat(b.cost))[0];
    if(cheapest) html+=`<h3>üí° Best Option:</h3><p>Buy from <strong>${cheapest.source}</strong> for ${cheapest.cost}${cheapest.currency||""}</p>`;

    details.innerHTML = html;
});

document.getElementById("modal-close").addEventListener("click", () => {
    const modal = document.getElementById("item-modal");
    modal.classList.add("hidden");
});
</script>

  
</body>
</html>
